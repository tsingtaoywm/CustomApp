# App定制化框架技术


这个项目的灵感来自在我在一家to B的互联网公司做技术分享，他们的工程师就给我介绍了他们目前最苦恼的一个技术问题。

他们公司有很多App产品，这些产品大同小异，可能在某个页面上仅仅是文字颜色的不同。为此，他们最初的做法是，有一个主产品A，然后BCDE等产品都基于A产品的代码开各自不同的分支，来解决不一样的代码。每次A产品增加功能，如果其他产品也需要这个功能，都要把代码合并到BCDE产品中。久而久之，随着迭代次数多了，代码就越来越难以管理了。

我相信行业内很多公司也都有类似的烦恼，比如说我看到的比较有名的App，例如沪江网，扇贝等等，还有更多的产品是放到国外使用的，不胜枚举，这些公司都有一系列App，功能都很相似。但我并不知道他们是怎么解决这个问题的。

也有的公司，是把所有的产品代码都写在一起，使用if else分支来控制某个功能会在哪几个产品中出现，于是他们的代码中参杂了大量的if else语句，和正常的业务逻辑混在一起，非常乱，到了后期，很难维护，因为要修改一个功能，要把所有if else的逻辑都看一遍，也不一定找全了。这样做很痛苦。

后来我就经徐川引荐，认识了绿点科技的邵辉（Eric），他就给我讲，他们公司有一套Flex定制化框架，专门用来处理这类需求，关于这个框架的思想，各位可以移步到，
https://github.com/hshaoGitHub/Android-Whitelabel-Demo

我和邵辉交流了很久，我记得第一次电话沟通就长达一个多小时。我了解到他们Android团队只有三到五个人，但却能支撑3条产品线，就得益于这个Flex定制化框架。

但是Flex框架对定制化的粒度控制的比较粗，可以理解为是模块级别的，因为Flex对于邵辉团队所维护的产品项目，就足够了，这符合了“不要过度设计”的思路。

当产品超级复杂，每条产品线都有5-8名Android开发人员的时候，Flex框架就不够用了，需要扩展了，所以我根据对Flex框架的理解，以及我这一个月对定制化框架的思考，写出了Custom这个定制化框架。我们要把这个定制化思想设计成一个通用的解决方案。

为什么我对定制化这个概念情有独钟呢，因为十年前我是做ASP.NET的，一下子就暴露年龄了，言归正传，国外有一个很有名DotNetNuke开源项目，就是通过在后台配置xml，从而在ASP.NET的Web页面中展示出来我们配置的功能，就是定制化的思想，这个思想终于要在App端使用了。

iOS版本稍后推出。

－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－－

以下是对于我这个项目的各种场景的描述，基本覆盖了定制化框架的所有涉及的场景：

假设有ABCDE五个产品。

1）基于配置实现：
场景1: 新功能，BCDE有，A没有
	解决方案1：把入口UI屏蔽掉，使用配置文件if else来控制

场景2: 对某个页面， CDE有相同的UI，AB有些不同，A多一个控件，B少一个控件
	在Core中放相同的Layout，处理所有最全的逻辑
	在ABC中，做一个同名的Layout，修改为自己的UI，分为加、减、改三种：
		[done]场景2_1：		A减去控件：因为在Core中Activity会用到减去的R.id，运行时会报找不到这个控件id的错误，所以，需要开关来控制，不走这段逻辑。
		[done]场景2_2：		B加上控件button
			［done］一种办法是，在产品B中，继承之前的Activity，使用Hook，替换之
			[done]另一种办法是（C中实现），copy一份相同package的Activity到Core中，覆盖之前的Activity，这时，这个Activity不需要配置
					要注意不要提交copy到core的的代码

		场景2_3（不做新demo了）：		C修改UI：指的是属性的修改，没有额外的工作。
			修改UI：在具体产品中加新的layout
			修改Activity逻辑：继承＋Hook
		
	结论：尽量做减法

2）基于AOP实现（稍后推出）